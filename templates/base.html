{% load static %}
<!doctype html>
<html>
<head>
  <script>
    (function () {
      try {
        const stored = localStorage.getItem("theme");
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        const theme = stored ? stored : (prefersDark ? "dark" : "light");
        if (theme === "dark") document.documentElement.classList.add("dark");
      } catch (_) {}
    })();
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sprint Demo</title>

  <style>
    body{font-family:system-ui;margin:2rem}
    nav a, nav form{margin-right:1rem;display:inline-block}
    .btn{padding:.4rem .8rem;border:1px solid #888;border-radius:.5rem;background:#f8f8f8}

    /* dark-mode overrides */
    .dark body { background:#0b1020; color:#e5e7eb; }
    .dark a { color:#a78bfa; }
    .dark .btn {
      background:#1f2937;
      color:#e5e7eb;
      border-color:#374151;
    }
  </style>

  <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=3">
</head>
<body>

  <nav class="navbar site-nav">
    <div class="container d-flex align-items-center justify-content-between">
      <a class="navbar-brand m" href="/">Class Demo</a>

      <div class="d-flex flex-wrap justify-content-center gap-2">
        {% if user.is_authenticated %}
          <a class="nav-link d-inline-block" href="{% url 'accounts:notifications_feed' %}">Notifications</a>
          <a class="nav-link d-inline-block" href="{% url 'accounts:profile' %}">Profile</a>
          <a class="nav-link d-inline-block" href="{% url 'accounts:profile_edit' %}">Edit Profile</a>
          <a class="nav-link d-inline-block" href="{% url 'accounts:password_change' %}">Change Password</a>
          <a class="nav-link d-inline-block" href="{% url 'accounts:password_reset' %}">Forgot Password</a>
          <a class="nav-link d-inline-block" href="{% url 'accounts:delete_account' %}">Delete Account</a>
          {% if user.is_staff or user.is_superuser %}
            <a class="nav-link d-inline-block" href="/admin/">Admin Search</a>
            <a class="nav-link d-inline-block" href="/admin/create-driver/">Create Driver</a>
            <a class="nav-link d-inline-block" href="/admin/create-sponsor/">Create Sponsor</a>
          {% endif %}
        {% endif %}
      </div>

      <div>
        {% if user.is_authenticated %}
          <form method="post" action="{% url 'accounts:logout' %}" style="display:inline">
            {% csrf_token %}
            <button class="btn btn-sm btn-muted" type="submit">Log Out</button>
          </form>
        {% else %}
          <a class="btn btn-sm btn-muted" href="{% url 'accounts:login' %}">Login</a>
          <a class="btn btn-sm btn-muted" href="{% url 'accounts:register' %}">Register</a>
          <a class="btn btn-sm btn-muted" href="{% url 'accounts:password_reset' %}">Forgot Password</a>
        {% endif %}

        
        <button class="btn btn-sm btn-muted" id="theme-toggle" type="button" aria-label="Toggle dark mode" aria-pressed="false">
          Dark Mode: Off
        </button>
      </div>
    </div>
  </nav>

  
  <div class="container-main">
    {% for m in messages %}<p>{{ m }}</p>{% endfor %}
    {% block content %}{% endblock %}
  </div>

  
  <script>
    (function () {
      const btn = document.getElementById("theme-toggle");
      if (!btn) return;

      const setLabel = () => {
        const on = document.documentElement.classList.contains("dark");
        btn.textContent = "Dark Mode: " + (on ? "On" : "Off");
        btn.setAttribute("aria-pressed", String(on));
      };

      setLabel();

      btn.addEventListener("click", () => {
        const root = document.documentElement;
        root.classList.toggle("dark");
        const on = root.classList.contains("dark");
        try { localStorage.setItem("theme", on ? "dark" : "light"); } catch (_) {}
        setLabel();
      });
    })();
  </script>
</body>
</html>
