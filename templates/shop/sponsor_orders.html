{% extends "base.html" %}
{% block title %}Manage Orders{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-shopping-cart"></i> Manage Orders</h1>
    <a href="{% url 'shop:sponsor_catalog' %}" class="btn btn-outline-primary">
      <i class="fas fa-arrow-left"></i> Back to Catalog
    </a>
  </div>

  <!-- Filters -->
  <form method="get" class="mb-4" style="display:flex; flex-wrap:wrap; gap:.5rem; align-items:center;">
    <label>
      Status:
      <select name="status" class="form-select" style="display:inline-block; width:auto;">
        <option value="">All</option>
        {% for value, label in STATUS_CHOICES %}
          <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </label>

    <label>
      Driver:
      <input type="text" name="driver" value="{{ driver_filter }}" placeholder="Search driver..." class="form-control" style="display:inline-block; width:auto;">
    </label>

    <button type="submit" class="btn btn-primary">Filter</button>
    <a href="{% url 'shop:sponsor_orders' %}" class="btn btn-secondary">Clear</a>
  </form>

  <!-- Orders Table -->
  {% if orders %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-light">
          <tr>
            <th>Order #</th>
            <th>Driver</th>
            <th>Placed</th>
            <th>Status</th>
            <th>Tracking</th>
            <th>Points</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
            <tr>
              <td><strong>#{{ order.id }}</strong></td>
              <td>{{ order.driver.username }}</td>
              <td>{{ order.placed_at|date:"M d, Y H:i" }}</td>
              <td>
                <span class="badge {% if order.status == 'pending' %}bg-secondary{% elif order.status == 'confirmed' %}bg-info{% elif order.status == 'processing' %}bg-warning text-dark{% elif order.status == 'shipped' %}bg-primary{% elif order.status == 'delivered' %}bg-success{% elif order.status == 'cancelled' %}bg-danger{% endif %}" 
                      style="{% if order.status == 'pending' %}background-color: #6c757d !important; color: white;{% elif order.status == 'confirmed' %}background-color: #0dcaf0 !important; color: white;{% elif order.status == 'processing' %}background-color: #ffc107 !important; color: black;{% elif order.status == 'shipped' %}background-color: #0d6efd !important; color: white;{% elif order.status == 'delivered' %}background-color: #198754 !important; color: white;{% elif order.status == 'cancelled' %}background-color: #dc3545 !important; color: white;{% endif %} padding: 0.35em 0.65em; border-radius: 0.25rem; font-weight: 500;">
                  {{ order.get_status_display }}
                </span>
              </td>
              <td>
                {% if order.tracking_number %}
                  <span class="font-monospace" style="font-family: monospace; font-size: 0.9em;">{{ order.tracking_number }}</span>
                {% else %}
                  <span class="text-muted">â€”</span>
                {% endif %}
              </td>
              <td>{{ order.points_spent }} pts</td>
              <td>
                <a href="{% url 'shop:sponsor_update_order' order.id %}" class="btn btn-sm btn-primary">
                  <i class="fas fa-edit"></i> Update
                </a>
                <a href="{% url 'shop:order_detail' order.id %}" class="btn btn-sm btn-outline-secondary" target="_blank">
                  <i class="fas fa-eye"></i> View
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
      <nav aria-label="Order pagination">
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if driver_filter %}&driver={{ driver_filter }}{% endif %}">Previous</a>
            </li>
          {% endif %}
          
          <li class="page-item active">
            <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
          </li>
          
          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if driver_filter %}&driver={{ driver_filter }}{% endif %}">Next</a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% else %}
    <div class="alert alert-info">
      <i class="fas fa-info-circle"></i> No orders found.
    </div>
  {% endif %}
</div>
{% endblock %}

