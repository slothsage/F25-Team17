{% extends "base.html" %}
{% block title %}My Profile{% endblock title %}

{% block content %}
<h1>My Profile</h1>
{% if request.user.driver_profile and request.user.driver_profile.image %}
  <p>
    <img src="{{ request.user.driver_profile.image.url }}" alt="Profile photo" style="width:120px;height:120px;object-fit:cover;border-radius:60px;border:1px solid #ddd;">
  </p>
{% endif %}
<p><b>Username:</b> {{ request.user.username }}</p>
<p><b>Email:</b> {{ request.user.email }}</p>

{% if request.user.driver_profile %}
  <p><b>Name:</b>
    {{ request.user.driver_profile.first_name }}
    {{ request.user.driver_profile.last_name }}</p>
  <p><b>Phone:</b> {{ request.user.driver_profile.phone }}</p>
  <p><b>Address:</b> {{ request.user.driver_profile.address }}</p>
  <p><b>City/State/Zip:</b>
    {{ request.user.driver_profile.city }},
    {{ request.user.driver_profile.state }}
    {{ request.user.driver_profile.zip_code }}</p>
{% if request.user.driver_profile.description %}
  <p><strong>Description:</strong> {{ request.user.driver_profile.description }}</p>
{% endif %}
{% else %}
  <p>No driver profile found yet.</p>
{% endif %}
<a class="btn btn-sm btn-muted" href="{% url 'accounts:profile_edit' %}">Edit Profile</a>
<a class="btn btn-sm btn-muted" href="{% url 'accounts:profile_preview' %}">Preview as Sponsor</a>
<hr>
<h2>Multi-Factor Authentication</h2>

<p>Status:
  {% if request.user.mfa and request.user.mfa.mfa_enabled %}
    <strong>Enabled</strong>
  {% else %}
    <strong>Disabled</strong>
  {% endif %}
</p>

<form method="post" action="{% url 'accounts:mfa_toggle' %}" onsubmit="return confirmToggle();">
  {% csrf_token %}
  {% if request.user.mfa and request.user.mfa.mfa_enabled %}
    <input type="hidden" name="action" value="disable">
    <p>Enter a 6-digit code to disable:</p>
  {% else %}
    <input type="hidden" name="action" value="enable">
    <p>Enter a 6-digit code to enable:</p>
    <p class="text-sm">
      First time? <a href="{% url 'accounts:mfa_setup' %}">Set up your authenticator app</a> to get a code.
    </p>
  {% endif %}

  <input name="code" maxlength="6" required inputmode="numeric" pattern="[0-9]{6}"
        placeholder="123456" autocomplete="one-time-code">
  <button type="submit">
    {% if request.user.mfa and request.user.mfa.mfa_enabled %}Disable MFA{% else %}Enable MFA{% endif %}
  </button>
</form>

<script>
function confirmToggle() {
  // Optional extra safety
  return confirm('Are you sure? This action requires a valid 6-digit code.');
}
</script>

{% endblock content %}