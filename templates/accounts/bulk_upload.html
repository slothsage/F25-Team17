{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <h1 class="mb-4">
        <i class="fas fa-upload me-2"></i>Bulk Upload {% if is_sponsor_user %}Drivers{% else %}Users{% endif %}
    </h1>
    
    {% if is_sponsor_user %}
    <div class="alert alert-info mb-4">
        <i class="fas fa-info-circle me-2"></i>
        <strong>Sponsor Upload:</strong> You can only upload drivers. All drivers you create will be automatically linked to your sponsor account.
    </div>
    {% endif %}

    <div class="card shadow-sm mb-4" style="max-width: 600px;">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">
                <i class="fas fa-file-csv me-2"></i>Upload CSV or TXT File
            </h5>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" id="uploadForm">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="file" class="form-label fw-bold">Select CSV or TXT File</label>
                    <div class="file-upload-area border rounded p-4 text-center" 
                         style="background: #f8f9fa; border-style: dashed !important; cursor: pointer;"
                         onclick="document.getElementById('file').click();">
                        <input type="file" 
                               name="file" 
                               id="file" 
                               accept=".csv,.txt" 
                               class="form-control d-none" 
                               required
                               onchange="handleFileSelect(this)">
                        <div id="filePlaceholder">
                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                            <p class="mb-0 text-muted">
                                <strong>Click to select a file</strong> or drag and drop
                            </p>
                            <p class="text-muted small mt-2">CSV or TXT files only (.csv, .txt)</p>
                        </div>
                        <div id="fileSelected" style="display: none;">
                            <i class="fas fa-file-csv fa-3x text-success mb-3"></i>
                            <p class="mb-0">
                                <strong id="fileName"></strong>
                            </p>
                            <p class="text-muted small mt-2" id="fileSize"></p>
                            <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="clearFile()">
                                <i class="fas fa-times me-1"></i>Remove
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary btn-lg" id="uploadBtn">
                        <i class="fas fa-upload me-2"></i>Upload & Process
                    </button>
                    {% if is_sponsor_user %}
                    <a href="{% url 'accounts:sponsor_driver_search' %}" class="btn btn-secondary btn-lg">
                        <i class="fas fa-times me-2"></i>Cancel
                    </a>
                    {% else %}
                    <a href="{% url 'admin_user_search' %}" class="btn btn-secondary btn-lg">
                        <i class="fas fa-times me-2"></i>Cancel
                    </a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function handleFileSelect(input) {
    if (input.files && input.files[0]) {
        const file = input.files[0];
        const fileName = file.name;
        const fileSize = (file.size / 1024).toFixed(2) + ' KB';
        
        document.getElementById('fileName').textContent = fileName;
        document.getElementById('fileSize').textContent = fileSize;
        document.getElementById('filePlaceholder').style.display = 'none';
        document.getElementById('fileSelected').style.display = 'block';
    }
}

function clearFile() {
    document.getElementById('file').value = '';
    document.getElementById('filePlaceholder').style.display = 'block';
    document.getElementById('fileSelected').style.display = 'none';
}

// Drag and drop functionality
const uploadArea = document.querySelector('.file-upload-area');
const fileInput = document.getElementById('file');

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.style.background = '#e9ecef';
});

uploadArea.addEventListener('dragleave', () => {
    uploadArea.style.background = '#f8f9fa';
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.style.background = '#f8f9fa';
    
    if (e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        handleFileSelect(fileInput);
    }
});

// Show loading state on form submit
document.getElementById('uploadForm').addEventListener('submit', function() {
    const btn = document.getElementById('uploadBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';
});
</script>
{% endblock %}
