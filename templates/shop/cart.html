{% extends "base.html" %}{% block content %}
<h1>My Cart</h1>

<h2>Delivery Address</h2>
<p>Current: {{ profile.address|default:"(not set)" }}</p>

<form method="post" action="{% url 'shop:cart' %}" style="margin:.5rem 0 1rem;">
  {% csrf_token %}
  <input type="hidden" name="action" value="update_address">
  {{ address_form.as_p }}   {# TEMP: render entire form to prove it's there #}
  <button class="btn" type="submit">Save Address</button>
</form>
<hr/>

{% if items %}
  <ul>
  {% for it in items %}
    <li>{{ it.name_snapshot }} — {{ it.quantity }} × {{ it.points_each }} pts</li>
  {% endfor %}
  </ul>
  <p><strong>Total:</strong> {{ total_points }} pts</p>

  <form method="post" action="{% url 'shop:clear_cart' %}">
    {% csrf_token %}
    <button class="btn" onclick="return confirm('Clear all items?')">Clear Cart</button>
  </form>
  <a href="{% url 'shop:checkout' %}" class="btn" style="background:#16a34a;color:#fff;">
      Proceed to Checkout
    </a>
  </div>
{% else %}
  <p>Your cart is empty.</p>
{% endif %}

{% endblock %}