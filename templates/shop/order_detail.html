{% extends "base.html" %}{% block content %}
<h1>Order #{{ order.id }}</h1>
<p>Status: <strong>{{ order.status|title }}</strong>
  {% if is_delayed %}
    <span style="margin-left:.5rem;padding:.15rem .4rem;border:1px solid #f59e0b;border-radius:.35rem;background:#fff7ed;">
      Delayed
    </span>
  {% endif %}
</p>
<p>Points spent: {{ order.points_spent }}</p>

<h3>Items</h3>
<ul>
{% for it in order.items.all %}
  <li>{{ it.name_snapshot }} — {{ it.quantity }} × {{ it.points_each }} pts = {{ it.line_points }} pts</li>
{% endfor %}
</ul>

<p>
  <a class="btn" href="{% url 'shop:order_receipt_pdf' order.id %}">
    <i class="fas fa-file-pdf"></i> Download Receipt (PDF)
  </a>
</p>

{% if order.status == "pending" or order.status == "processing" %}
  <form method="post" action="{% url 'shop:cancel_order' order.id %}" style="display:inline">
    {% csrf_token %}
    <button class="btn" type="submit">Cancel Order</button>
  </form>
{% endif %}

{% if order.can_mark_received %}
  <form method="post" action="{% url 'shop:mark_order_received' order.id %}">
    {% csrf_token %}
    <button class="btn">Mark as received</button>
  </form>
{% endif %}

<p><a class="btn" href="{% url 'shop:order_list' %}">Back to Orders</a></p>
{% endblock %}